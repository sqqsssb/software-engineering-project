阶段用户控制功能

![image-20250604160339251](C:\Users\25740\AppData\Roaming\Typora\typora-user-images\image-20250604160339251.png)

![image-20250604160710602](C:\Users\25740\AppData\Roaming\Typora\typora-user-images\image-20250604160710602.png)

### 一、已完成的修改

1. **Phase 类的增强**
   - 添加了 `role_prompts` 参数支持
   - 增加了状态管理相关属性（`phase_state`）
   - 添加了阶段状态管理方法（`get_phase_state`, `update_phase_state`, `reset_phase_state`）

2. **ComposedPhase 类的修改**
   - 在初始化 Phase 实例时添加了 `assistant_role_prompt` 和 `user_role_prompt` 参数
   - 从 `role_prompts` 字典中获取角色提示

3. **ChatChain 类的增强**
   - 在 `execute_step` 方法中添加了用户交互功能
   - 实现了阶段结论展示、修改和文档生成功能
   - 修复了时间格式处理问题

### 二、API 接口说明

1. **阶段状态管理接口**
```python
# 获取阶段状态
phase.get_phase_state()
# 返回格式：
{
    'task_prompt': str,
    'current_turn': int,
    'is_completed': bool,
    'needs_restart': bool,
    'restart_prompt': str
}

# 更新阶段状态
phase.update_phase_state(**kwargs)
# 参数示例：
{
    'task_prompt': '新的任务提示',
    'current_turn': 1,
    'is_completed': False
}

# 重置阶段状态
phase.reset_phase_state()
```

2. **阶段执行接口**
```python
# 执行阶段
phase.execute(chat_env, chat_turn_limit, need_reflect)
# 参数说明：
# - chat_env: 聊天环境对象
# - chat_turn_limit: 最大对话轮数
# - need_reflect: 是否需要反思
# 返回：更新后的 chat_env
```

3. **文档生成接口**
```python
# 生成阶段文档
doc_path = os.path.join(chat_env.env_dict['directory'], f"{phase}_documentation.md")
# 文档内容：
# - 阶段结论
# - 环境信息
# - 阶段状态
```

### 三、前后端开发建议

1. **前端开发**
   - 可以基于现有的用户交互界面，开发更友好的 Web 界面
   - 需要实现的功能：
     - 阶段执行状态显示
     - 结论展示和修改界面
     - 文档查看和下载
     - 阶段控制（继续/修改/查看文档）

2. **后端开发**
   - 可以基于现有的 Flask 服务器进行扩展
   - 需要实现的 API：
     ```python
     # 阶段控制 API
     @app.route('/api/phase/execute', methods=['POST'])
     @app.route('/api/phase/modify', methods=['POST'])
     @app.route('/api/phase/document', methods=['GET'])
     
     # 状态管理 API
     @app.route('/api/phase/state', methods=['GET', 'POST'])
     @app.route('/api/phase/reset', methods=['POST'])
     ```

3. **数据库设计**
   - 需要存储的信息：
     - 阶段状态
     - 阶段结论
     - 修改历史
     - 文档内容

4. **扩展建议**
   - 可以添加用户认证系统
   - 实现多项目并行开发
   - 添加版本控制功能
   - 实现实时协作功能

### 四、使用示例

1. **命令行模式**
```bash
python run.py --config Online_Shopping_System --task "开发一个在线购物系统" --name shopping_system
```

2. **API 调用示例**
```python
# 执行阶段
response = requests.post('http://localhost:5000/api/phase/execute', 
    json={'phase': 'DemandAnalysis', 'task': '开发在线购物系统'})

# 修改阶段
response = requests.post('http://localhost:5000/api/phase/modify',
    json={'phase': 'DemandAnalysis', 'modification': '添加支付功能'})

# 获取文档
response = requests.get('http://localhost:5000/api/phase/document',
    params={'phase': 'DemandAnalysis'})
```

这些接口和功能为前后端开发提供了良好的基础，开发团队可以根据具体需求进行扩展和优化。



电商平台生成示例

![image-20250604161430795](C:\Users\25740\AppData\Roaming\Typora\typora-user-images\image-20250604161430795.png)

![image-20250604161448538](C:\Users\25740\AppData\Roaming\Typora\typora-user-images\image-20250604161448538.png)